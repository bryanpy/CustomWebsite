var products = {
    "Alexa": {
      "price":4999,
      "category":["tech"],
      "rate":4,
      "description": "Echo Dot (3rd Gen, 2018 release) - Smart speaker with Alexa - Charcoal",
      "reviews": [
        {"name":"Ankith","text": "very good product defenitly reccomned it","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Bag1":{
      "price":700,
      "category":["styl"],
      "rate":4.5,
      "description": "HYC00 Travel Duffel Bag, Sports Tote Gym Bag, Shoulder Weekender Overnight Bag for Men and Women",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "extremely fashionable product love it but it is a bit expensive","stars": 3}
      ]
    },
    "Bag2":{
      "price":3500,
      "category":["styl"],
      "rate":5,
      "description": "Adidas Alliance II Sackpack, Black, One Size, Bag",
      "reviews": [
        {"name":"Ruban","text": "Fits for all dresses and styles","stars": 4.5},
        {"name":"Braden","text": "It is very easy to carry any where","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Bike":{
      "price":13999,
      "category":["styl","acce"],
      "rate":3.5,
      "description": "Huffy Hardtail Mountain Bike, Stone Mountain 26 inch, 21-Speed, Lightweight, Dark Blue",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Camera":{
      "price":34000,
      "category":["tech"],
      "rate":3.7,
      "description": "Digital Camera, FHD 1080P Digital Camera for Kids Video Camera with 32GB SD Card 16X Digital Zoom, Compact Point and Shoot Camera Portable Small Camera for Teens Students Boys Girls Seniors(Black)",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Glasses":{
      "price":10000,
      "category":["styl"],
      "rate":4.9,
      "description": "Gaoye Blue Light Blocking Glasses - 3 Pack Fashion Square Fake Eyeglasses, Anti UV Ray Computer Gaming Glasses, Blue Blockers Glasses for Women/Men, Matte Black+Leopard+Transparent",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Headphones":{
      "price":4500,
      "category":["tech"],
      "rate":4.3,
      "description": "Sony ZX Series Wired On-Ear Headphones, Black MDR-ZX110",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Lipstick":{
      "price":800,
      "category":["styl"],
      "rate":3.8,
      "description": "Wet n wild Silk Finish Lip Stick, Just Garnet, 0.13 Ounce",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Plant":{
      "price":2000,
      "category":["furn"],
      "rate":3,
      "description": "Fake Succulent, Mini Succulents Plants Artificial in Black Modern Human Shaped Ceramic Pots Cute Desk Decor Desk Plant for Office Decor for Women, Cute Fake Plants Bathroom Decor 2PCS",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Shoes":{
      "price":9000,
      "category":["styl"],
      "rate":3.8,
      "description": "Bruno Marc Men's Leather Lined Dress Oxfords Shoes",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "SmartWatch":{
      "price":6000,
      "category":["tech"],
      "rate":4.2,
      "description": "Smart Watch for Men Women, 2022 Fitness Tracker 1.69\" Touch Screen Smartwatch Fitness Watch 25 Sports IP68 Waterproof, Heart Rate/Sleep Monitor/Pedometer/Calories, Activity Tracker for Android iPhone",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Stool":{
      "price":3000,
      "category":["furn"],
      "rate":4,
      "description": "Folding Step Stool - The Lightweight Step Stool is Sturdy Enough to Support Adults and Safe Enough for Kids. Opens Easy with One Flip. Great for Kitchen, Bathroom, Bedroom, Kids or Adults.",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "WaterBottle":{
      "price":580,
      "category":["acce"],
      "rate":5,
      "description": "IRON Â°FLASK Sports Water Bottle - 40 Oz, 3 Lids (Straw Lid), Leak Proof, Vacuum Insulated Stainless Steel, Double Walled, Thermo Mug, Metal Canteen",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Watch":{
      "price":14000,
      "category":["tech"],
      "rate":4.7,
      "description": "Casio F91W-1 Classic Resin Strap Digital Sport Watch",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "IPhone":{
      "price":99800,
      "category":["tech"],
      "rate":4.5,
      "description": "Apple iPhone 12, 64GB, Green - Unlocked (Renewed Premium)",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    },
    "Mouse":{
      "price":2000,
      "category":["tech"],
      "rate":4.3,
      "description": "Logitech M510 Wireless Computer Mouse for PC with USB Unifying Receiver - Graphite",
      "reviews": [
        {"name":"Ankith","text": "Really Good Product","stars": 4.5},
        {"name":"Braden","text": "Really Nice Product, For all ages","stars": 4},
        {"name":"BoB","text": "It is the best product ever","stars": 3}
      ]
    }
  }
  

let productGrid = document.getElementById("product-grid")
let productContainer = document.createElement("div")

let searchState = false

let toDisplay = products;

productContainer.classList.add("product-container")
productGrid.appendChild(productContainer)

document.getElementById("search-button").addEventListener("click", ()=>{
    search()
})

document.addEventListener("keydown", (e)=>{
    if(e.key == "Enter") {
        search()
    }
})

document.addEventListener("click",(e)=>{
    display()
})

display()

function search() {
    console.log(searchState)
    if(searchState == false){
        toDisplay = searchItems(toDisplay, document.getElementById("header-search").value)
        display()
        searchState = true
        document.getElementById("search-button").classList.remove("fa-magnifying-glass")
        document.getElementById("search-button").classList.add("fa-xmark")
    }else{
        toDisplay = products
        display()
        searchState = false

        document.getElementById("search-button").classList.add("fa-magnifying-glass")
        document.getElementById("search-button").classList.remove("fa-xmark")
        document.getElementById("header-search").value = ""
    }
}

function display() {
    productGrid.innerHTML = ""

    let tempJson = {}

    for (let x = 0; x < Object.keys(toDisplay).length; x++) {
        if (Object.values(toDisplay)[x]['category'].includes(filter["category"]) || filter["category"] == "all"){
            if(Object.values(toDisplay)[x]['rate'] >= filter["rating"]) {
                tempJson[Object.keys(toDisplay)[x]] = Object.values(toDisplay)[x]
            }
        }
    }

    if(Object.keys(tempJson).length == 0){
        productGrid.innerHTML = "Item Not Found"
        productGrid.style.color = "black"
        productGrid.style.textAlign = "center"
        productGrid.style.marginTop = "300px"
        return
    }else{
        productGrid.style.textAlign = "center"
        productGrid.style.marginTop = "0px"
    }
    for (let x = 0; x < Object.keys(tempJson).length; x++) {
        let product = document.createElement("div")
        if ((((x / 5) + 1) % 1) != 0) {

            product.classList.add("product")

            product.innerHTML = createItem(Object.keys(tempJson)[x], Object.keys(tempJson)[x], Object.values(tempJson)[x]["price"])

            productContainer.appendChild(product)
        } else {
            productContainer = document.createElement("div")
            productContainer.classList.add("product-container")
            productGrid.appendChild(productContainer)

            product.classList.add("product")

            product.innerHTML = createItem(Object.keys(tempJson)[x], Object.keys(tempJson)[x], Object.values(tempJson)[x]["price"])

            productContainer.appendChild(product)


        }
    }
}

function createItem(imageName,productName,price){
    return(
        '<img onclick="window.location = \'../pages/productInfo.html?product='+ productName +'\'" src="../assets/productPictures/'+ imageName +'.jpg" alt="Image" class="product-image">\n' +
            '<div><h2 onclick="window.location = \'../pages/productInfo.html?product='+ productName +'\'" id="product-name" class="product-text text">'+ products[productName]["description"].slice(0,100).replace(/[0-9]/g, '') +'</h2>\n' +
            '<h2 id="product-price" class="product-text text">'+ price +'â‚¹</h2>\n' +
            '<h2 id="product-rating" class="product-text text">'+ calcStars(products[productName]["rate"]) +'</h2>\n' +
            '<h2 id="product-addtocart" class="product-text text" onclick=\'addItemtoCart("'+productName+'")\'>+Add to Cart</h2></div></div>'
    )
}



function searchItems(json,keyword) {
    let tempJson = {}
    for (let x = 0; x < Object.keys(json).length; x++) {
        if(toDisplay[Object.keys(toDisplay)[x]]["description"].toLowerCase().includes(keyword)) {
            tempJson[Object.keys(toDisplay)[x]] = Object.values(toDisplay)[x]
        }
    }
    console.log(tempJson)
    return (tempJson)
}

function calcStars(rating){
    let moons = ["ðŸŒ•","ðŸŒ˜","ðŸŒ—","ðŸŒ–","ðŸŒ‘"]
    let rate = ""
    for (let x = 0; x < Math.floor(rating); x++) {
        rate += moons[0]
    }

    let empRate = ""
    for (let x = 0; x < Math.floor(5-rating); x++) {
        empRate += moons[4]
    }
    let des = rating-Math.floor(rating)

    let desmoon = ""
    if(des < 0.5 && des != 0)
        desmoon = "ðŸŒ˜"
    else if(des > 0.5)
        desmoon = "ðŸŒ–"
    else if(des == 0.5)
        desmoon = "ðŸŒ—"

    return("Rating: "+rate+desmoon+empRate+" "+rating)
}

function setFilterProperty(property,value){
    filter[property] = value
}